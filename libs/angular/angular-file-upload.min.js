/*
 angular-file-upload v1.1.5
 https://github.com/nervgh/angular-file-upload
*/
(function(b,a){if(typeof define==="function"&&define.amd){define("angular-file-upload",["angular"],function(c){return a(c)})}else{return a(b)}}(typeof angular==="undefined"?null:angular,function(a){var b=a.module("angularFileUpload",["sn.controls"]);"use strict";b.value("fileUploaderOptions",{url:"/",alias:"file",headers:{},queue:[],progress:0,autoUpload:false,removeAfterUpload:false,method:"POST",filters:[],formData:[],queueLimit:Number.MAX_VALUE,withCredentials:false}).factory("FileUploader",["fileUploaderOptions","$rootScope","$http","$window","$compile","LoginService",function(k,l,j,d,f,g){function n(p){var q=a.copy(k);a.extend(this,q,p,{isUploading:false,_nextIndex:0,_failFilterIndex:-1,_directives:{select:[],drop:[],over:[]}});this.filters.unshift({name:"queueLimit",fn:this._queueLimitFilter});this.filters.unshift({name:"folder",fn:this._folderFilter})}n.prototype.isHTML5=!!(d.File&&d.FormData);n.prototype.addToQueue=function(u,q,t){var v=this.isArrayLikeObject(u)?u:[u];var r=this._getFilters(t);var s=this.queue.length;var p=[];a.forEach(v,function(z){var x=new n.FileLikeObject(z);if(this._isValidFile(x,r,q)){var w=new n.FileItem(this,z,q);p.push(w);this.queue.push(w);this._onAfterAddingFile(w)}else{var y=this.filters[this._failFilterIndex];this._onWhenAddingFileFailed(x,y,q)}},this);if(this.queue.length!==s){this._onAfterAddingAll(p);this.progress=this._getTotalProgress()}this._render();if(this.autoUpload){this.uploadAll()}};n.prototype.removeFromQueue=function(r){var p=this.getIndexOfItem(r);var q=this.queue[p];if(q.isUploading){q.cancel()}this.queue.splice(p,1);q._destroy();this.progress=this._getTotalProgress()};n.prototype.clearQueue=function(){while(this.queue.length){this.queue[0].remove()}this.progress=0};n.prototype.uploadItem=function(s){var p=this.getIndexOfItem(s);var r=this.queue[p];var t=this.isHTML5?"_xhrTransport":"_iframeTransport";var q=this;j.jsonp(g.config.base+"authStatus?callback=JSON_CALLBACK").success(function(u){if(u.hasLogin){r._prepareToUploading();if(q.isUploading){return}q.isUploading=true;q[t](r)}else{g.popupLoginContainer();g.enqueue(function(){r._prepareToUploading();if(q.isUploading){return}q.isUploading=true;q[t](r)})}})};n.prototype.cancelItem=function(r){var p=this.getIndexOfItem(r);var q=this.queue[p];var s=this.isHTML5?"_xhr":"_form";if(q&&q.isUploading){q[s].abort()}};n.prototype.uploadAll=function(){var p=this.getNotUploadedItems().filter(function(q){return !q.isUploading});if(!p.length){return}a.forEach(p,function(q){q._prepareToUploading()});p[0].upload()};n.prototype.cancelAll=function(){var p=this.getNotUploadedItems();a.forEach(p,function(q){q.cancel()})};n.prototype.isFile=function(q){var p=d.File;return(p&&q instanceof p)};n.prototype.isFileLikeObject=function(p){return p instanceof n.FileLikeObject};n.prototype.isArrayLikeObject=function(p){return(a.isObject(p)&&"length" in p)};n.prototype.getIndexOfItem=function(p){return a.isNumber(p)?p:this.queue.indexOf(p)};n.prototype.getNotUploadedItems=function(){return this.queue.filter(function(p){return !p.isUploaded})};n.prototype.getReadyItems=function(){return this.queue.filter(function(p){return(p.isReady&&!p.isUploading)}).sort(function(q,p){return q.index-p.index})};n.prototype.destroy=function(){a.forEach(this._directives,function(p){a.forEach(this._directives[p],function(q){q.destroy()},this)},this)};n.prototype.onAfterAddingAll=function(p){};n.prototype.onAfterAddingFile=function(p){};n.prototype.onWhenAddingFileFailed=function(r,q,p){};n.prototype.onBeforeUploadItem=function(p){};n.prototype.onProgressItem=function(p,q){};n.prototype.onProgressAll=function(p){};n.prototype.onSuccessItem=function(r,q,p,s){};n.prototype.onErrorItem=function(r,q,p,s){};n.prototype.onCancelItem=function(r,q,p,s){};n.prototype.onCompleteItem=function(r,q,p,s){};n.prototype.onCompleteAll=function(){};n.prototype._getTotalProgress=function(s){if(this.removeAfterUpload){return s||0}var q=this.getNotUploadedItems().length;var p=q?this.queue.length-q:this.queue.length;var r=100/this.queue.length;var t=(s||0)*r/100;return Math.round(p*r+t)};n.prototype._getFilters=function(p){if(a.isUndefined(p)){return this.filters}if(a.isArray(p)){return p}var q=p.match(/[^\s,]+/g);return this.filters.filter(function(r){return q.indexOf(r.name)!==-1},this)};n.prototype._render=function(){if(!l.$$phase){l.$apply()}};n.prototype._folderFilter=function(p){return !!(p.size||p.type)};n.prototype._queueLimitFilter=function(){return this.queue.length<this.queueLimit};n.prototype._isValidFile=function(q,r,p){this._failFilterIndex=-1;return !r.length?true:r.every(function(s){this._failFilterIndex++;return s.fn.call(this,q,p)},this)};n.prototype._isSuccessCode=function(p){return(p>=200&&p<300)||p===304};n.prototype._transformResponse=function(p,r){var q=this._headersGetter(r);a.forEach(j.defaults.transformResponse,function(s){p=s(p,q)});return p};n.prototype._parseHeaders=function(t){var p={},r,s,q;if(!t){return p}a.forEach(t.split("\n"),function(u){q=u.indexOf(":");r=u.slice(0,q).trim().toLowerCase();s=u.slice(q+1).trim();if(r){p[r]=p[r]?p[r]+", "+s:s}});return p};n.prototype._headersGetter=function(p){return function(q){if(q){return p[q.toLowerCase()]||null}return p}};n.prototype._xhrTransport=function(r){var s=r._xhr=new XMLHttpRequest();var q=new FormData();var p=this;p._onBeforeUploadItem(r);a.forEach(r.formData,function(t){a.forEach(t,function(v,u){q.append(u,v)})});q.append(r.alias,r._file,r.file.name);s.upload.onprogress=function(u){var t=Math.round(u.lengthComputable?u.loaded*100/u.total:0);p._onProgressItem(r,t)};s.onload=function(){var v=p._parseHeaders(s.getAllResponseHeaders());var u=p._transformResponse(s.response,v);var t=p._isSuccessCode(s.status)?"Success":"Error";var w="_on"+t+"Item";p[w](r,u,s.status,v);p._onCompleteItem(r,u,s.status,v)};s.onerror=function(){var u=p._parseHeaders(s.getAllResponseHeaders());var t=p._transformResponse(s.response,u);p._onErrorItem(r,t,s.status,u);p._onCompleteItem(r,t,s.status,u)};s.onabort=function(){var u=p._parseHeaders(s.getAllResponseHeaders());var t=p._transformResponse(s.response,u);p._onCancelItem(r,t,s.status,u);p._onCompleteItem(r,t,s.status,u)};s.open(r.method,r.url,true);s.withCredentials=r.withCredentials;a.forEach(r.headers,function(u,t){s.setRequestHeader(t,u)});s.send(q);this._render()};n.prototype._iframeTransport=function(t){var s=a.element('<form style="display: none;" />');var q=a.element('<iframe name="iframeTransport'+Date.now()+'">');var p=t._input;var r=this;if(t._form){t._form.replaceWith(p)}t._form=s;r._onBeforeUploadItem(t);p.prop("name",t.alias);a.forEach(t.formData,function(u){a.forEach(u,function(x,w){var v=a.element('<input type="hidden" name="'+w+'" />');v.val(x);s.append(v)})});s.prop({action:t.url,method:"POST",target:q.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"});q.bind("load",function(){try{var v=q[0].contentDocument.body.innerHTML}catch(w){}var y={response:v,status:200,dummy:true};var x={};var u=r._transformResponse(y.response,x);r._onSuccessItem(t,u,y.status,x);r._onCompleteItem(t,u,y.status,x)});s.abort=function(){var w={status:0,dummy:true};var v={};var u;q.unbind("load").prop("src","javascript:false;");s.replaceWith(p);r._onCancelItem(t,u,w.status,v);r._onCompleteItem(t,u,w.status,v)};p.after(s);s.append(p).append(q);j.jsonp(g.config.base+"authStatus?callback=JSON_CALLBACK").success(function(u){if(u.hasLogin){s[0].submit();this._render()}else{g.popupLoginContainer();g.enqueue(function(){return sendRequest(baseUrl+url,param,"post").then(function(v){defer.resolve(v)})})}})};n.prototype._onWhenAddingFileFailed=function(r,q,p){this.onWhenAddingFileFailed(r,q,p)};n.prototype._onAfterAddingFile=function(p){this.onAfterAddingFile(p)};n.prototype._onAfterAddingAll=function(p){this.onAfterAddingAll(p)};n.prototype._onBeforeUploadItem=function(p){p._onBeforeUpload();this.onBeforeUploadItem(p)};n.prototype._onProgressItem=function(r,p){var q=this._getTotalProgress(p);this.progress=q;r._onProgress(p);this.onProgressItem(r,p);this.onProgressAll(q);this._render()};n.prototype._onSuccessItem=function(r,q,p,s){r._onSuccess(q,p,s);this.onSuccessItem(r,q,p,s)};n.prototype._onErrorItem=function(r,q,p,s){r._onError(q,p,s);this.onErrorItem(r,q,p,s)};n.prototype._onCancelItem=function(r,q,p,s){r._onCancel(q,p,s);this.onCancelItem(r,q,p,s)};n.prototype._onCompleteItem=function(s,r,q,t){s._onComplete(r,q,t);this.onCompleteItem(s,r,q,t);var p=this.getReadyItems()[0];this.isUploading=false;if(a.isDefined(p)){p.upload();return}this.onCompleteAll();this.progress=this._getTotalProgress();this._render()};n.isFile=n.prototype.isFile;n.isFileLikeObject=n.prototype.isFileLikeObject;n.isArrayLikeObject=n.prototype.isArrayLikeObject;n.isHTML5=n.prototype.isHTML5;n.inherit=function(q,p){q.prototype=Object.create(p.prototype);q.prototype.constructor=q;q.super_=p};n.FileLikeObject=m;n.FileItem=o;n.FileDirective=c;n.FileSelect=h;n.FileDrop=e;n.FileOver=i;function m(q){var p=a.isElement(q);var t=p?q.value:q;var s=a.isString(t)?"FakePath":"Object";var r="_createFrom"+s;this[r](t)}m.prototype._createFromFakePath=function(p){this.lastModifiedDate=null;this.size=null;this.type="like/"+p.slice(p.lastIndexOf(".")+1).toLowerCase();this.name=p.slice(p.lastIndexOf("/")+p.lastIndexOf("\\")+2)};m.prototype._createFromObject=function(p){this.lastModifiedDate=a.copy(p.lastModifiedDate);this.size=p.size;this.type=p.type;this.name=p.name};function o(t,u,q){var s=a.isElement(u);var p=s?a.element(u):null;var r=!s?u:null;a.extend(this,{url:t.url,alias:t.alias,headers:a.copy(t.headers),formData:a.copy(t.formData),removeAfterUpload:t.removeAfterUpload,withCredentials:t.withCredentials,method:t.method},q,{uploader:t,file:new n.FileLikeObject(u),isReady:false,isUploading:false,isUploaded:false,isSuccess:false,isCancel:false,isError:false,progress:0,index:null,_file:r,_input:p});if(p){this._replaceNode(p)}}o.prototype.upload=function(){this.uploader.uploadItem(this)};o.prototype.cancel=function(){this.uploader.cancelItem(this)};o.prototype.remove=function(){this.uploader.removeFromQueue(this)};o.prototype.onBeforeUpload=function(){};o.prototype.onProgress=function(p){};o.prototype.onSuccess=function(q,p,r){};o.prototype.onError=function(q,p,r){};o.prototype.onCancel=function(q,p,r){};o.prototype.onComplete=function(q,p,r){};o.prototype._onBeforeUpload=function(){this.isReady=true;this.isUploading=true;this.isUploaded=false;this.isSuccess=false;this.isCancel=false;this.isError=false;this.progress=0;this.onBeforeUpload()};o.prototype._onProgress=function(p){this.progress=p;this.onProgress(p)};o.prototype._onSuccess=function(q,p,r){this.isReady=false;this.isUploading=false;this.isUploaded=true;this.isSuccess=true;this.isCancel=false;this.isError=false;this.progress=100;this.index=null;this.onSuccess(q,p,r)};o.prototype._onError=function(q,p,r){this.isReady=false;this.isUploading=false;this.isUploaded=true;this.isSuccess=false;this.isCancel=false;this.isError=true;this.progress=0;this.index=null;this.onError(q,p,r)};o.prototype._onCancel=function(q,p,r){this.isReady=false;this.isUploading=false;this.isUploaded=false;this.isSuccess=false;this.isCancel=true;this.isError=false;this.progress=0;this.index=null;this.onCancel(q,p,r)};o.prototype._onComplete=function(q,p,r){this.onComplete(q,p,r);if(this.removeAfterUpload){this.remove()}};o.prototype._destroy=function(){if(this._input){this._input.remove()}if(this._form){this._form.remove()}delete this._form;delete this._input};o.prototype._prepareToUploading=function(){this.index=this.index||++this.uploader._nextIndex;this.isReady=true};o.prototype._replaceNode=function(p){var q=f(p.clone())(p.scope());q.prop("value",null);p.css("display","none");p.after(q)};function c(p){a.extend(this,p);this.uploader._directives[this.prop].push(this);this._saveLinks();this.bind()}c.prototype.events={};c.prototype.bind=function(){for(var p in this.events){var q=this.events[p];this.element.bind(p,this[q])}};c.prototype.unbind=function(){for(var p in this.events){this.element.unbind(p,this.events[p])}};c.prototype.destroy=function(){var p=this.uploader._directives[this.prop].indexOf(this);this.uploader._directives[this.prop].splice(p,1);this.unbind()};c.prototype._saveLinks=function(){for(var p in this.events){var q=this.events[p];this[q]=this[q].bind(this)}};n.inherit(h,c);function h(p){h.super_.apply(this,arguments);if(!this.uploader.isHTML5){this.element.removeAttr("multiple")}this.element.prop("value",null)}h.prototype.events={$destroy:"destroy",change:"onChange"};h.prototype.prop="select";h.prototype.getOptions=function(){};h.prototype.getFilters=function(){};h.prototype.isEmptyAfterSelection=function(){return !!this.element.attr("multiple")};h.prototype.onChange=function(){var r=this.uploader.isHTML5?this.element[0].files:this.element[0];var p=this.getOptions();var q=this.getFilters();if(!this.uploader.isHTML5){this.destroy()}this.uploader.addToQueue(r,p,q);if(this.isEmptyAfterSelection()){this.element.prop("value",null)}};n.inherit(e,c);function e(p){e.super_.apply(this,arguments)}e.prototype.events={$destroy:"destroy",drop:"onDrop",dragover:"onDragOver",dragleave:"onDragLeave"};e.prototype.prop="drop";e.prototype.getOptions=function(){};e.prototype.getFilters=function(){};e.prototype.onDrop=function(s){var p=this._getTransfer(s);if(!p){return}var q=this.getOptions();var r=this.getFilters();this._preventAndStop(s);a.forEach(this.uploader._directives.over,this._removeOverClass,this);this.uploader.addToQueue(p.files,q,r)};e.prototype.onDragOver=function(q){var p=this._getTransfer(q);if(!this._haveFiles(p.types)){return}p.dropEffect="copy";this._preventAndStop(q);a.forEach(this.uploader._directives.over,this._addOverClass,this)};e.prototype.onDragLeave=function(p){if(p.currentTarget!==this.element[0]){return}this._preventAndStop(p);a.forEach(this.uploader._directives.over,this._removeOverClass,this)};e.prototype._getTransfer=function(p){return p.dataTransfer?p.dataTransfer:p.originalEvent.dataTransfer};e.prototype._preventAndStop=function(p){p.preventDefault();p.stopPropagation()};e.prototype._haveFiles=function(p){if(!p){return false}if(p.indexOf){return p.indexOf("Files")!==-1}else{if(p.contains){return p.contains("Files")}else{return false}}};e.prototype._addOverClass=function(p){p.addOverClass()};e.prototype._removeOverClass=function(p){p.removeOverClass()};n.inherit(i,c);function i(p){i.super_.apply(this,arguments)}i.prototype.events={$destroy:"destroy"};i.prototype.prop="over";i.prototype.overClass="nv-file-over";i.prototype.addOverClass=function(){this.element.addClass(this.getOverClass())};i.prototype.removeOverClass=function(){this.element.removeClass(this.getOverClass())};i.prototype.getOverClass=function(){return this.overClass};return n}]).directive("nvFileSelect",["$parse","FileUploader",function(c,d){return{link:function(h,g,e){var i=h.$eval(e.uploader);if(!(i instanceof d)){throw new TypeError('"Uploader" must be an instance of FileUploader')}var f=new d.FileSelect({uploader:i,element:g});f.getOptions=c(e.options).bind(f,h);f.getFilters=function(){return e.filters}}}}]).directive("nvFileDrop",["$parse","FileUploader",function(c,d){return{link:function(h,g,e){var i=h.$eval(e.uploader);if(!(i instanceof d)){throw new TypeError('"Uploader" must be an instance of FileUploader')}if(!i.isHTML5){return}var f=new d.FileDrop({uploader:i,element:g});f.getOptions=c(e.options).bind(f,h);f.getFilters=function(){return e.filters}}}}]).directive("nvFileOver",["FileUploader",function(c){return{link:function(g,f,d){var h=g.$eval(d.uploader);if(!(h instanceof c)){throw new TypeError('"Uploader" must be an instance of FileUploader')}var e=new c.FileOver({uploader:h,element:f});e.getOverClass=function(){return d.overClass||this.overClass}}}}]);return b}));
